# 2024 年日志

## 12月日志

> [!info] 
>
> `数据库理论基础`
>
> 事务传播级别
>
> 

> [!warning]
>
> `高并发` `数据一致性` `事务传播` `锁粒度设计`
>
> 并发场景下，发现数据库写入数据不一致时，可以考虑是否是事务传播级别引起的，此外其他可能引起数据不一致的：
>
> 1. 未加锁或锁设计不合理导致多线程并发修改导致数据不一致



## 11月日志

> [!info]
>
> `Java` `SpringBoot` 
>
> 通过以下代码块模拟程序异常场景：
>
> ```Java
>      // X0% 的概率进入 1/0
>      if (new Random().nextInt(10) < 9) {
>          log.error(LOG + "命中异常分支...");
>          int i = 1 / 0;
>      }
> ```
>
> 异常场景主要用于验证代码的健壮性，如：异常回滚等。

> [!info]
>
> MyBatis配置输出SQL:
>
> ```YML
> mybatis-plus:
> configuration:
>  log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
> ```
>
> 配合 IDEA `MyBatis Log Free` 插件查看SQL输出
>
> <img src="https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/image-20241202140815514.png" alt="image-20241202140815514" style="zoom:50%;" />

> [!caution]
>
> `spring-boot-starter-amqp:2.3.4.RELEASE` 
>
>  `RabbitMQ 3.12.14`
>
>   `Erlang 25.3.2.13`
>
> 
>
> rabbitmq 消费端消费失败后，需考虑重试机制。
>
> 引入重试机制后需考虑消息重复消费问题，确保数据幂等。
>
> 此外，重试策略要选好，避免短时间内产生大量重试请求，造成系统压力和消息堆积，重试到一定次数后仍未成功的，需把消息推送到死信队列做进一步处理。
>
> 注意，对于数据一致性要求高的场景，如：与钱袋子💰相关的，建议使用**手动ACK模式**，确保消息处理的准确性。
>
> - 参考
>
>   - [RabbitMQ解决消费者补偿幂等问题(重复消费问题)](https://blog.csdn.net/belongtocode/article/details/104310152)
>
>   - [RabbitMQ的消息确认机制Ack Mode](https://blog.csdn.net/qq_60638478/article/details/141220718) 
>
>   - [SpringBoot整合RabbitMQ（小兔子成神之路）](https://blog.csdn.net/AkiraNicky/article/details/89640512)
>
>   - [Spring AMQP](https://docs.spring.io/spring-boot/reference/messaging/amqp.html)


> [!warning]
> Docker 拉取镜像慢时，需配置==可访问==的第三方镜像，如：
>
> ```json
> {
> "registry-mirrors": [
>  "http://hub-mirror.c.163.com",
>  "https://docker.mirrors.ustc.edu.cn",
>  "https://pee6w651.mirror.aliyuncs.com"
> ]
> }
> ```
> 配置后，需要重载文件、重启Docker服务

> [!tip]
> Docker 常用镜像的启动参数得懂，比如启动 MySQL:
> ```shell
> docker run -d --restart=always --name mysql \
> -v /datas/mysql/data:/var/lib/mysql \
> -v /datas/mysql/conf:/etc/mysql \
> -v /datas/mysql/log:/var/log/mysql \
> -p 3306:3306 \
> -e TZ=Asia/Shanghai \
> -e MYSQL_ROOT_PASSWORD=root \
> mysql:5.6 \
> --character-set-server=utf8mb4 \
> --collation-server=utf8mb4_general_ci
> ```
> 
> ```
> -v /datas/mysql/data:/var/lib/mysql：将数据文件夹挂载到主机
> -v /datas/mysql/conf:/etc/mysql：将配置文件夹挂在到主机，可以在宿主机放一份自定义 my.cnf文件，那么容器就会按自定义配置启动
> -v /datas/mysql/log:/var/log/mysql：将日志文件夹挂载到主机
> -p 3306:3306：将容器的3306端口映射到主机的3306端口
> -e MYSQL_ROOT_PASSWORD=root：初始化root用户的密码
> --character-set-server=utf8mb4：设置字符集
> --collation-server=utf8mb4_general_ci：排序方式
> ```

> [!tip]
> 可以在 Win/Mac 下同时配置 Github、Gitee，也可以一个项目管理同时关联Gitee、Github库


## 10月日志

> [!info]
> CAT 成功部署并访问，环境如下：
> 
>  虚拟机 Linux Centos8  `Linux localhost.localdomain 4.18.0-348.7.1.el8_5.x86_64 #1 SMP Wed Dec 22 13:25:12 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux`
> 
>  JAVA8 `java version "1.8.0_431"`
> 
>  TOMCAT7 `apache-tomcat-7.0.99.tar.gz`
> 
>  MAVEN3 `Apache Maven 3.6.3`
