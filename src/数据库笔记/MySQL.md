---
author: æŒ¯æŒ¯
title: MySQL
order: 1
icon: file
date: 2024-03-19
category:
  - DB
  - MySQL
---

# å‚è€ƒ

- ğŸ”— [MySQL éš¾ç‚¹è§£æ](https://time.geekbang.org/dailylesson/topic/143) 
- [MySQLå®˜æ–¹ï¼šExample Databases](https://dev.mysql.com/doc/index-other.html) ï¼ˆ[ä»‹ç»](https://blog.csdn.net/horses/article/details/106795844)ï¼‰
  - [employee data (large dataset, includes data and test/verification suite)](https://github.com/datacharmer/test_db) [PDF](https://downloads.mysql.com/docs/employee-en.a4.pdf)

- ğŸ”— [MySQL Â· ç­”ç–‘è§£æƒ‘ Â· ç´¢å¼•è¿‡æ»¤æ€§å¤ªå·®å¼•èµ·CPUé£™é«˜åˆ†æ](http://mysql.taobao.org/monthly/2015/10/03/)
- ğŸ”— [æ•°æ®åº“å†…æ ¸æœˆæŠ¥](http://mysql.taobao.org/monthly/) ğŸ“ é˜¿é‡Œå·´å·´
- ğŸ“š ã€ŠAlibaba Java å¼€å‘æ‰‹å†Œã€‹ ğŸ“ ch5 MySQL æ•°æ®åº“

# å­˜å‚¨å¼•æ“

- InnoDBï¼Œæ”¯æŒäº‹åŠ¡ã€å¹¶å‘æ§åˆ¶ã€‚
- MyISAMï¼Œé€‚åˆæ’å…¥å’ŒæŸ¥è¯¢ã€‚
- Memoryï¼Œæ•°æ®å­˜æ”¾åœ¨å†…å­˜ã€‚



# é«˜æ€§èƒ½ã€é«˜å¯ç”¨ MySQL æ¶æ„è®¾è®¡

- ğŸ”— [å¦‚ä½•æ­å»ºä¸€æ¬¾é«˜æ€§èƒ½ã€é«˜å¯ç”¨çš„ MySQL æ¶æ„ï¼Ÿ](https://time.geekbang.org/dailylesson/detail/100044011?tid=143)



# æ…¢ SQL 

## å®šä½æŠ€æœ¯

1. æ…¢æŸ¥è¯¢æ—¥å¿—
2. æœåŠ¡ç›‘æ§

### æ…¢æŸ¥è¯¢æ—¥å¿—å®šä½æ…¢SQL

1. å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼š mysql> set global slow_query_log = on;
2. è®¾ç½®æ…¢æŸ¥è¯¢é˜ˆå€¼ï¼šmysql> set global long_query_time = 0.001; ï¼ˆæ—¶é—´å•ä½ï¼šç§’ï¼‰
3. ç¡®å®šæ…¢æŸ¥è¯¢æ—¥å¿—è·¯å¾„ï¼šmysql> show global variables like "datadir";
4. ç¡®å®šæ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶åï¼šshow global variables like "slow_query_log_file";
5. é€€å‡ºMySQLï¼Œåœ¨æœåŠ¡å™¨ä¸­æ‰§è¡Œï¼štail -n5 /var/lib/mysql/c1978ad7fe24-slow.log

![image-20240827104504130](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/image-20240827104504130.png)



## åˆ†ææŠ€æœ¯

ä½¿ç”¨ explain(æ‰§è¡Œè®¡åˆ’) åˆ†ææ…¢ SQLã€‚

```sql
explain + SQL æŸ¥è¯¢è¯­å¥;
```

## ä¼˜åŒ–æ‰‹æ®µ

- åˆ†é¡µä¼˜åŒ–
- ç´¢å¼•ä¼˜åŒ–
- è¿æ¥ä¼˜åŒ–
- æ’åºä¼˜åŒ–
- Union ä¼˜åŒ–

### åˆ†é¡µä¼˜åŒ–

```sql
select * from table where type = 2 and level = 9 order by id asc limit 190289,10;
```

ä¼˜åŒ–1ï¼šå»¶è¿Ÿå…³è”

```sql
select a.* from table a, 
 (select id from table where type = 2 and level = 9 order by id asc limit 190289,10 ) b
 where a.id = b.id
```

ä¼˜åŒ–2ï¼šä¹¦ç­¾æ¨¡å¼

```sql
  select * from table where id >
  (select * from table where type = 2 and level = 9 order by id asc limit 190
```

### ç´¢å¼•ä¼˜åŒ– *

è§†æƒ…è€Œå®šã€‚

**<u>==ä¼˜åŒ–1ï¼šä½¿ç”¨è¦†ç›–ç´¢å¼•==</u>**

```sql
select name from test where city='ä¸Šæµ·'
```

è¢«æŸ¥è¯¢å­—æ®µä¸æŸ¥è¯¢æ¡ä»¶å»ºç«‹è”åˆç´¢å¼•ï¼š

```sql
alter table test add index idx_city_name (city, name);
```

**<u>==ä¼˜åŒ–2ï¼šç¦ç”¨ `!=` å’Œ `<>`==</u>**

ä½¿ç”¨ `!=` å’Œ `<>` ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚

```sql
column <> 'a' æ”¹ï¼š column > 'a' or column < 'a'
```

**<u>==ä¼˜åŒ–3ï¼šä½¿ç”¨å‰ç¼€ç´¢å¼•==</u>**

```
alter table test add index index2(email(6));
```



# SQL JOIN

ä¸€å›¾çœ‹æ‡‚ SQL çš„æ‰€æœ‰è¿æ¥ï¼Œä»éŸ¦æ©å›¾è§†è§’ç†è§£å·¦è¿æ¥ã€å³è¿æ¥ã€å†…è¿æ¥ç­‰ã€‚



# ç´¢å¼•è¯¦è§£ï¼ˆé‡ç‚¹ï¼‰

- ä¼˜ç‚¹ï¼šåœ¨æ•°æ®è¾¾åˆ°ä¸€å®šé‡æ—¶ï¼Œç´¢å¼•å¯åŠ å¿«æ•°æ®æ£€ç´¢é€Ÿåº¦ï¼Œå‡å°‘IOæ¬¡æ•°
- ç¼ºç‚¹ï¼šéœ€è¦é¢å¤–çš„å­˜å‚¨ç©ºé—´ç»´æŠ¤ç´¢å¼•ï¼ŒåŒæ—¶ï¼Œè¿›è¡Œæ•°æ®æ›´æ–°æ“ä½œæ—¶ï¼Œç´¢å¼•ç»“æ„ä¹Ÿä¼šå‘ç”Ÿç›¸åº”å˜åŒ–ï¼Œç»§è€Œå½±å“SQLæ‰§è¡Œæ•ˆç‡ï¼Œæ­¤å¤–ï¼Œåœ¨è¡¨æ•°æ®é‡ä¸å¤§æ—¶ï¼Œç´¢å¼•æœªå¿…ä¼˜äºå…¨è¡¨æ‰«æã€‚

ä¸»è¦ä»¥[è¿™ç¯‡](https://github.com/Snailclimb/JavaGuide/blob/main/docs/database/mysql/mysql-index.md)æ–‡ç« ä¸ºä¸»ï¼Œé‡ç‚¹äº†è§£ä»¥ä¸‹å†…å®¹ï¼š

1. äº†è§£ç´¢å¼•çš„ä¼˜ç¼ºç‚¹
2. ç†Ÿæ‚‰ç´¢å¼•çš„åº•å±‚æ•°æ®ç»“æ„
3. ç†Ÿç»ƒæŒæ¡ç´¢å¼•çš„åˆ†ç±»åŠå…¶åº”ç”¨åœºæ™¯
4. ç´¢å¼•çš„æœ€ä½³å®è·µåŸåˆ™

å…¶ä¸­ï¼Œç´¢å¼•åº•å±‚æ•°æ®ç»“æ„çš„é€‰å‹ï¼Œéœ€è¦ææ¸…æ¥šä¸ºä»€ä¹ˆæ˜¯é€‰æ‹© Bæ ‘ å’Œ B+æ ‘ ç»“æ„è€Œéå…¶ä»–æ•°æ®ç»“æ„ï¼š

- HASHç»“æ„ã€‚ä¸æ”¯æŒé¡ºåºå’ŒèŒƒå›´æŸ¥è¯¢ï¼Œå› ä¸ºæ•°æ®æ˜¯ç¦»æ•£åˆ†å¸ƒçš„ã€‚

- ###### äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆ**B**inary **S**earch **T**reeï¼‰ã€‚å®¹æ˜“ä»å¹³è¡¡æ ‘é€€åŒ–æˆæ–œæ ‘ï¼ˆçº¿æ€§é“¾è¡¨ï¼‰è¿›è€Œå¯¼è‡´æŸ¥è¯¢æ•ˆç‡æ€¥å‰§ä¸‹é™

- è‡ªå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆ**AVL**ï¼‰ã€‚é¢‘ç¹è¿›è¡Œæ—‹è½¬æ“ä½œä»¥ä¿æŒå¹³è¡¡ï¼Œå¢åŠ é¢å¤–å¼€é”€ï¼›æŸ¥è¯¢æ•°æ®æ•£åˆ—åœ¨å¤šä¸ªèŠ‚ç‚¹æ—¶ï¼Œä¼šè¿›è¡Œå¤šæ¬¡ç£ç›˜IOæ“ä½œã€‚

- çº¢é»‘æ ‘ã€‚**ä¸AVLæ ‘çš„åŒºåˆ«**åœ¨äºä¸è¿½æ±‚ä¸¥æ ¼çš„å¹³è¡¡ï¼Œè€Œæ˜¯å¤§è‡´å¹³è¡¡ã€‚

- **Bæ ‘** & **B+æ ‘** ï¼ˆ**å¤šè·¯å¹³è¡¡æŸ¥æ‰¾æ ‘**ï¼‰ã€‚Bæ ‘çš„æ‰€æœ‰èŠ‚ç‚¹æ—¢å­˜æ”¾**é”®ï¼ˆKEYï¼‰**ä¹Ÿå­˜æ”¾**æ•°æ®ï¼ˆDATAï¼‰**ã€‚B+æ ‘åªæœ‰å¶å­èŠ‚ç‚¹å­˜æ”¾é”®ï¼ˆKEYï¼‰å’Œæ•°æ®ï¼ˆDATAï¼‰ï¼Œå…¶ä½™èŠ‚ç‚¹åªæ”¾**é”®ï¼ˆKEYï¼‰**ã€‚



> Bæ ‘ä¸B+æ ‘

![å…¸å‹çš„Bæ ‘](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/1*eTJjGhhJSBPUMSnF0pXdzw-20240827143118258.png)





![B+æ ‘ï¼šA simple B+ tree example linking the keys 1â€“7 to data values d1-d7. The linked list (red) allows rapid in-order traversal. This particular treeâ€™s branching factor is b](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/1*e3HHF3bVteXVtsWodTe4pA-20240827143146398.png)











# ä½¿ç”¨åŸåˆ™

## ç´¢å¼•åŸåˆ™ *

- åŸåˆ™1ï¼šä¸šåŠ¡ä¸Šå…·æœ‰å”¯ä¸€ç‰¹æ€§çš„å­—æ®µï¼Œå³ä½¿æ˜¯ç»„åˆå­—æ®µï¼Œä¹Ÿå¿…é¡»å»ºæˆå”¯ä¸€ç´¢å¼•ã€‚
- åŸåˆ™2ï¼šè¶…è¿‡ä¸‰ç« è¡¨ç¦æ­¢ä½¿ç”¨ join ï¼Œå¤–é”®çš„æ•°æ®ç±»å‹ä¿æŒç»å¯¹ä¸€è‡´ï¼Œä¸”æœ‰ç´¢å¼•ã€‚
- åŸåˆ™3ï¼šé¡µé¢æœç´¢ç¦æ­¢ä½¿ç”¨å·¦æ¨¡ç³Šæˆ–å…¨æ¨¡ç³Šï¼Œå¦‚éœ€è¦èµ°æœç´¢å¼•æ“è§£å†³ã€‚
- åŸåˆ™4ï¼šä½¿ç”¨ `order by` æ—¶ï¼Œæ³¨æ„ç´¢å¼•çš„æœ‰åºæ€§ã€‚

## SQL åŸåˆ™ *

- åŸåˆ™1ï¼šä¸è¦ç”¨ `count(åˆ—å)` å’Œ `count(å¸¸é‡)` ä»£æ›¿ `count(*)` ï¼Œ åœ¨ç»Ÿè®¡è¡Œæ•°ä¸Šï¼Œ`count(*)` ä¼šç»Ÿè®¡å€¼ä¸º NULL çš„è¡Œã€‚
- åŸåˆ™2ï¼šå¤šè¡¨æŸ¥è¯¢æˆ–å˜æ›´æ—¶ï¼Œéœ€ä½¿ç”¨åˆ«åé™å®šè¡¨åï¼Œå¦‚ `table_first as t1`
- åŸåˆ™3ï¼šç¦æ­¢ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹ï¼ŒåŸå› æœ‰ä¸‰ï¼šéš¾è°ƒè¯•ã€éš¾æ‰©å±•ã€ä¸å¯ç§»æ¤ã€‚
- åŸåˆ™4ï¼šåœ¨åˆ†å¸ƒå¼ã€é«˜å¹¶å‘é›†ç¾¤åœºæ™¯ä¸‹ï¼Œç¦æ­¢ä½¿ç”¨å¤–é”®å’Œçº§è”ã€‚
- åŸåˆ™5ï¼šä»£ç åˆ†é¡µé€»è¾‘ï¼Œå…ˆ count å page ï¼Œè‹¥ count=0 ï¼Œ åˆ™ç›´æ¥è¿”å›ã€‚

# ç´¢å¼•åˆ†ç±»

![008vxvgGgy1h87wx8lsulj30gh0fewf7](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/008vxvgGgy1h87wx8lsulj30gh0fewf7.jpg)



# ç´¢å¼•å»ºç«‹



# ç´¢å¼•å¤±æ•ˆ

ç´¢å¼•å¤±æ•ˆçš„ 5 ç§æƒ…å†µ :

1. éšå¼ç±»å‹è½¬æ¢
2. è¡¨è¾¾å¼è®¡ç®—
3. æ“ä½œç¬¦åˆ¤æ–­ï¼Œå¦‚ `!=` ã€`>` ã€`<` ã€`<=` ã€`or` ã€ `in`ã€`is null`ã€`is not null`
4. å‡½æ•°
5. `like %XXX `æˆ– `like %XXX%` 
6. è”åˆç´¢å¼•ä¸æ»¡è¶³æœ€å·¦åŒ¹é…åŸåˆ™

ç´¢å¼•å¤±æ•ˆçš„**==åŸå› ==**ï¼š

1. ç´¢å¼•åˆ—ä¸ç´¢å¼•æ ‘ç»“æ„åŒ¹é…å¤±è´¥ï¼Œå¯¼è‡´è§¦å‘**==å›è¡¨æŸ¥è¯¢==**ã€‚







äº‹åŠ¡ï¼Œä¸ºè§£å†³**æ•°æ®ä¸€è‡´æ€§**è€Œç”Ÿã€‚

# äº‹åŠ¡

- ğŸ”— [ä¸‰åˆ†é’Ÿå›¾è§£äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œçœ‹ä¸€éå°±æ‡‚](https://blog.51cto.com/u_15177525/4161377)



# äº‹åŠ¡ä½œç”¨

å¯¹æ•°æ®æŒä¹…åŒ–æ—¶ï¼Œäº‹åŠ¡ä¿éšœäº†æŒä¹…åŒ–æ“ä½œæ»¡è¶³ï¼šâ€œè¦ä¹ˆå…¨éƒ¨æ‰§è¡ŒæˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œâ€çš„åŸåˆ™ã€‚







# äº‹åŠ¡ç‰¹æ€§

**==<u>ç®€è®°ï¼šå„æŒä¸€å…ƒ</u>==**

- åŸå­æ€§ï¼ˆAï¼‰ï¼šäº‹åŠ¡ä¸å¯å†åˆ†
- ä¸€è‡´æ€§ï¼ˆCï¼‰ï¼šæ‰§è¡Œäº‹åŠ¡åï¼Œæ•°æ®ä¸€è‡´
- éš”ç¦»æ€§ï¼ˆIï¼‰ ï¼šäº‹åŠ¡ä¹‹é—´äº’ä¸å¹²æ‰°
- æŒä¹…æ€§ï¼ˆDï¼‰ï¼šäº‹åŠ¡æäº¤åï¼Œæ•°æ®å³æŒä¹…åŒ–æˆåŠŸ

AIDæ˜¯æ‰‹æ®µï¼ŒCæ˜¯ç›®çš„ï¼Œå³åªæœ‰ä¿è¯äº†äº‹åŠ¡çš„AIDåï¼ŒDæ‰èƒ½å¾—åˆ°ä¿éšœï¼š

![AID->C](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/008vxvgGgy1h7r7c3ca63j309r0ab0sw.jpg)



# å¹¶å‘äº‹åŠ¡

åœ¨äº‹åŠ¡å¹¶å‘ä¸­ï¼ˆè¶…è¿‡2ä¸ªäº‹åŠ¡æ“ä½œæ•°æ®ï¼‰ï¼Œå¯èƒ½å¯¼è‡´4ç±»é—®é¢˜çš„å‡ºç°ï¼š

- è„è¯»
- å¹»è¯»
- ä¸å¯é‡å¤è¯»
- ä¸¢å¤±ä¿®æ”¹

> è„è¯»åœºæ™¯

![è„è¯»åœºæ™¯](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/008vxvgGgy1h8jhudskk7j30wq0iojtb.jpg)

> å¹»è¯»åœºæ™¯

![å¹»è¯»åœºæ™¯](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/008vxvgGgy1h8jhv8mnyyj30tu0ioac0.jpg)

> ä¸å¯é‡å¤è¯»åœºæ™¯ï¼šä¸¤æ¬¡è¯»åˆ°çš„æ•°æ®ä¸ä¸€è‡´ã€‚

![é—«æ˜¥æ—](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/008vxvgGgy1h8jhuqhrgoj30to0i8gn4.jpg)

> ä¸¢å¤±ä¿®æ”¹

# äº‹åŠ¡éš”ç¦»

äº‹åŠ¡éš”ç¦»ç”¨äºè§£å†³äº‹åŠ¡å¹¶å‘ä¸­äº§ç”Ÿçš„ 4 ç±»é—®é¢˜ï¼Œäº‹åŠ¡éš”ç¦»çº§åˆ«æœ‰ 4 ç§ï¼Œä»ä½åˆ°é«˜ï¼š

1. è¯»æœªæäº¤
2. è¯»å·²æäº¤
3. å¯é‡å¤è¯» ==*==  ï¼ˆå¸¸ç”¨ï¼‰
4. å¯ä¸²è¡ŒåŒ–

ä¸åŒéš”ç¦»çº§åˆ«å¯¹æ€§èƒ½å½±å“ä¸åŒï¼š

![ä¸åŒéš”ç¦»çº§åˆ«å¯¹æ€§èƒ½å½±å“](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/008vxvgGgy1h8ji4ny6d7j30zc0jc0ux.jpg)



# æ€§èƒ½ä¼˜åŒ– *

åœ¨å¹¶å‘åœºæ™¯ä¸‹ï¼Œäº‹åŠ¡ä¼šå½±å“æ•°æ®åº“çš„å¹¶å‘æ€§èƒ½ï¼Œå› æ­¤åœ¨å®é™…å¼€å‘ä¸­ï¼Œè¦æ³¨æ„æ’æŸ¥äº‹åŠ¡ä½¿ç”¨çš„åˆç†æ€§ã€‚

![é—«æ˜¥æ—](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/008vxvgGgy1h8jiaycvgzj30tc0gmwg4-20240827095748496.jpg)
