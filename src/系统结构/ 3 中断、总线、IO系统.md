---
title: 中断、总线、IO系统
order: 3
icon: file
category:
  - 系统结构	
  - 理论基础
---

# 中断、总线、IO系统

## 本章涉及的公式或表达式

1. 集中式控制方式的控制线的根数
2. 通道流量计算公式及单位换算



# 真题

## 简答题 

【中断系统篇】

简述中断的**概念**、**分类依据**及**分类目的**。 **1510** **2008**

简述中断**分成优先级的原因**及**分级的方法**。**1810**  **1104**  x

简述**中断处理次序**和**中断响应次序**的不同点。**1304** 

简述中断的**概念**和中断系统采用**软硬件结合的好处** **2110**

简述**中断系统**和**作用** **2210**

简述中断系统的**主要功能**和**要求**。**1710** 

【总线系统篇】

简述**总线控制**的三种方式及各需要增加用于总线控制的控制线根数 **2010** 

简述集中式**串行链接**方式的**优点**、**总线的分配过程** **1704** **1804** x 

简述集中式**独立请求**的优缺点和缺点、以及总线分配过程 **1904** **1610**  **1504**  

简述**专用总线**的概念并说明专用总线的优点和缺点 **1410** 

【IO系统篇】

简述**字节多路通道**、**选择通道**、**数组多路通道**的**适用连接的设备**、特点、**各种类型通道在满负荷时的实际流量与所连接设备的关系**数据传输方式 **2104**、**1404** 、**1904**、**1604**、**1107** x2

## 应用题

### 中断处理过程示意图

![image-20230319164150489](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/image-20230319164150489.png)

### 通道流量计算 **

![image-20230306214111465](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/image-20230306214111465.png)

![image-20230306213936342](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/image-20230306213936342.png)

![image-20230306213546511](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/image-20230306213546511.png)

![image-20230306213159841](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/image-20230306213159841.png)



# 中断系统 * * ^ 

> 简述**中断系统**和**作用** **2210** ^

中断系统是整个计算机系统不可缺少的重要组成部分。它对程序的监视和跟踪、人机联系、故障管理、多道程序和分时处理、实时处理、目态程序和操作系统的联系、输入输出处理以及多处理机系统中各机的联系等都起着重要的作用。

## 概念

<b style="color:red">什么是中断？</b> CPU终止正在执行的程序，转去处理随机提出的请求，待请求处理完后，再回到原先被打断的程序继续恢复执行的过程，叫中断。**注意：中断是一个过程！**

## 分类【*^】

分类依据：将**中断源性质相近**、**中断处理过程类似**的归为一类。

- 内部中断，由 CPU 异常引起。
- 外部中断，由中断信号引起。**常见的有定时器中断、外部信号中断、中断键中断。**
- 软件中断，由自陷指令引起。

分类目的： 减少**中断处理程序入口**；减少**中断硬件数量**。

**中断分类** ：从高到低

1. **访管中断**，当用户程序需**操作系统介入**时触发。
2. **程序性中断**，包括指令和数据格式错误、程序执行中出现的异常（溢出、**除数为0**）等。
3. **外部中断**，来自计算机外部，如定时器中断、外部信号中断、中断键中断。
4. **I/O中断**，CPU与IO设备（或IO通路）交互过程中引起的中断。
5. **重启中断**，CPU重启程序时引起的中断。

> 【例】IBM370 将中断分成**6类**：
>
> 机器校验、程序性、管理程序调用、外部、输入/输出、重新启动。 <u>**简记：机程管外输重**</u>



⚠️ **相关真题做得不好**，如：1204#6A、1410#4C、1510#5D、1910#4A、2008#3B、2110#6 

![image-20230306212949823](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/image-20230306212949823.png)

![image-20230306213228096](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/image-20230306213228096.png)

![image-20230306213422944](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/image-20230306213422944.png)

![image-20230402155110805](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/image-20230402155110805.png)

![image-20230306213915396](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/image-20230306213915396.png)

![image-20230306214002335](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/image-20230306214002335.png)



## 分级

中断分成优先级的**原因**：**中断源**是相互**独立**且**随机**发出请求的。当多个中断源同时发出请求时，CPU只能响应和处理优先级相对高的请求，因此需要对多个中断源的响应和处理安排一个优先顺序。

分级的**方法**：中断分类后，**同一类**内部各中断请求的**优先次序由软件或通道进行管理**；**不同类**的中断需根据中断的性质、紧迫性、重要性及软件处理的方便性分成若干优先级，以便CPU有序响应并处理中断请求。

一般地，优先级**从高到低**，分级如下：

第1级，**机器校验**。因掉电、地址错、数据错、通路错等必须及时处理，否则系统无法正常工作。

第2级，**程序性**中断

第3级，**管理程序调用**

第4级，**外部**中断

第5级，**输入输出**中断

第6级，**重启**中断

<u>**简记：从高到低，机程外输重。**</u>

> 【例】IBM370 中断响应优先次序：
>
> 紧急的机器校验 > 程序性和管程调用 > 可抑制的机器校验 ＞ 外部 ＞ I/O  ＞ 重启

![image-20230306214033442](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/image-20230306214033442.png)

**3B**



## 响应次序与处理次序  * 

> 简述**中断处理次序**和**中断响应次序**的不同点。**1304** 

中断处理次序是由排队器实现的，次序是固定好的；

中断响应次序是由软件实现的，通过设置**中断级屏蔽位**来控制优先级。

> 简述中断的**概念**和中断系统采用**软硬件结合的好处** **2110**

**中断响应次序**是在同时发生多个中断请求时，由**排队器**决定中断响应次序，以此**加快响应**和**断点现场的保存**；
**中断处理次序**是在进行中断处理时，对中断进行**分级**处理。中断处理次序用**软件技术**实现，可以**提高系统灵活性**。 

<b style="color:red">如何设计各级中断处理程序的设置中断级屏蔽位？</b>

1. 看”中断处理次序“的顺序
2. 根据”屏蔽规则则“设置”屏蔽“或开放。 （**屏蔽规则：**在设置中断级屏蔽位时，需使现行PSW**屏蔽同级和低级**的中断请求。）



> ![image-20230211133817239](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/image-20230211133817239.png)
>
> 例中有“什么时候回到用户程序（主程序）”的场景，如在【2、3级】中断都响应完之后，会回到用户程序。再如【4级】亦是如此。
>
> 因为这两组都是在执行中断时被其他中断请求打断了，如【2、3】被【4】打断了；【4】被【1】打断了。



## 软、硬件功能分配 ^

中断系统**功能**包括：

- **中断请求的保存与清理、分析与处理**；
- **中断优先级的确认**；
- **中断断点及现场保护**。 ^

中断系统的软、硬件功能分配实质上是**中断处理程序软件**和**中断响应硬件**的功能分配。其**要求**有2个：

1. **中断响应速度要快**
2. **中断处理要灵活性**

> 【图】中断响应硬件部分原理简图
>
> ![image-20230211134426568](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/image-20230211134426568.png)

# 总线系统 

总线是用于互连计算机、CPU、存储器、I/O端口及外部设备、远程通信设备间信息传送通路的集合。简言之，**总线是设备间信息传输通路的集合**。总线与其相配合的附属**控制电路**统称为**总线系统**。按照信息传送功能、性能的不同，总线系统包括数据线、地址线、时序和中断信号等控制／状态线、电源线、地线以及备用线等，其中：

- 数据线的根数决定同时传送的数据位数，即数据通路宽度 
- 地址线的根数决定直接寻址的范围 
- 控制／状态线决定总线的功能和使用能力 
- 备用线用于系统功能的扩充



## 分类 *

![总线的分类](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/e6c9d24ely1h4sot41z4lj210u0pcq4h.jpg)

专用总线：只连接一对物理部件的总线。

非专用总线：可以被多个部件分时共享的总线。

## 控制方式 *  

- **集中式控制**：**<u>简记：串3定2独1</u>**
- 分布式控制（超纲）

**集中式控制**：总线控制机构基本集中在一起，不论是在连接到总线的一个部件中，还是在单独的硬件中

### 串行链接（$3$ 根）

关键词：3条线，发送请求，响应请求，串行，信号建立，信号移除。

![IMG_39E7860D556C-1](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/IMG_39E7860D556C-1.jpeg)

**串行链接的工作方式： ^** 

![串行链接的控制方式](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/%E4%B8%B2%E8%A1%8C%E9%93%BE%E6%8E%A5%E7%9A%84%E6%8E%A7%E5%88%B6%E6%96%B9%E5%BC%8F-6100136.png)

优先次序确定的问题：是由【”总线可用“】线所接部件的物理位置决定。

**优点**：

- 选择算法简单，控制总线数少；
- 部件增减容易，可扩充性好；
- 逻辑简单，容易通过重复设置提高可靠性。

**缺点**：

- 对**线路失效**敏感；
- 总线分配速度受限；
- 设备增减或移动受限。

### 定时查询（$2 + log_2 N$ 根）

![image-20220316124018599](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/e6c9d24ely1h4son24imhj214a0o477j.jpg)

**优点**：**部件优先次序由程序控制**，灵活度高，可靠性强 。

**缺点**：控制线数多且控制复杂，扩展性差；速度取决于**计数信号的频率**和**部件数**。

### 独立请求（$2N+1$ 根）

![image-20220914223739233](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/e6c9d24egy1h66ifhzzmpj21d60qcn18.jpg)

**优点：**

1. 总线分配速度快；
2. 无需查询；
3. 控制器使用程序可控方式灵活确定下一个使用总线的部件；
4. 能方便地隔离失效部件的请求 ;

**缺点：**

1. 控制线数量多且控制器复杂；

   

## 总线的通信技术

信息在总线上的传送方法有两种：**同步**和**异步**。 **^**



## 数据宽度与总线线数

总线控制线根数：**<u>简记：串3定2独1</u>**

**数据宽度**：I/O 设备取得 **I/O 总线**后传送的数据总量。其不同于数据通路宽度

**数据通路宽度**：**数据总线**的物理宽度，即一个时钟周期传送的数据量。

一个数据宽度可能需要多个时钟周期才能完成。

### 数据宽度的类型

- 单字，适用于输入机、打字机等低速设备。
- 定长块，适用于磁盘等高速设备。
- 可变长块，适用于高优先级的中高速磁带、磁盘等设备。

### 总线线数 ·

对于总线线数，需要知道 4 点：

1. 线数多，则成本高，干扰强，可靠性低；线越长，则成本高，干扰强，波形畸变严重。
2. 在满足性能的前提下应尽量减少线数。总线的线数可通过**线的组合**、**编码**及**并/串-串/并转换**来减少，但一般会降低总线的流量 **^**
3. 总线的类型、控制方式、通信技术、数据宽度和总线的线数确定后，总线的申请、使用方式及相应的规范也就确定了
4. 总线的流量取决于该总线所接的外设的数量，种类以及传输信息的方式和效率要求





# I/O系统



![O系统](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/e6c9d24egy1h4y5bl4nrcj21180u0418.jpg)





## 输入输出原理（IO原理） 

### 输入输出系统 ·

**输入输出系统的概念**：处理机与主存储器之外的部分系统，包括了输入输出的设备、接口、软件等。

> 运算器、控制器、主存储器、总线一般也是通过输入输出系统进行管理。

**输入输出系统的特点**： ·

- ~是处理机与外界进行数据交换的通道
- ~是系统中最具多样性和复杂性的部分
- ~涉及机、光、电、磁、自动控制等多种学科
- ~最典型地反应着软硬件的相互结合
- ~复杂性隐藏在系统软件中，用户无需了解其细节

输入输出系统的特点集中反应在**异步性**、**实时性**、**与设备无关性**三个基本要求上，并对输入输出系统的组织产生决定性影响。

**输入输出系统的组织方式**

针对异步性，采用自治控制的办法；

针对实时性，采用层次结构的办法；

针对与设备无关性，采用分类处理的办法

> 【图】
>
> ![image-20230211154056828](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/image-20230211154056828.png)

### 输入输出的基本方式 *

- 程序控制 I/O
- 直接存储器访问（DMA）
- I/O 处理机

## 通道处理机 * **

👉🏻 [http://kjwy.5any.com/jsjxtjg/content/03/jsjxtjg-kcjj-030402.htm](http://kjwy.5any.com/jsjxtjg/content/03/jsjxtjg-kcjj-030402.htm)



通道处理机输入输出过程的时间关系图：

![image-20220714125551493](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/e6c9d24egy1h4q6c504cej212a0ligo3.jpg)

结论：应用程序（目态）每完成一次输入输出操作时，CPU仅两次进入管态，降低了对目态程序的干扰，提升了CPU与多种、多台外设并行工作的效率。



### 通道类型 ** 

**<u>简记：选字数</u>**

![通道类型](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/e6c9d24egy1h4q6c0wavtj20nu0b03z0.jpg)

![image-20220714125936837](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/e6c9d24egy1h4q6c2t961j215m0cmtbq.jpg)



#### 字节多路通道

字节多路通道的工作方式、数据宽度、适用范围：

1. 工作方式：分时共享，字节交叉
2. 传输原理：选择好设备后，一次只传输一个字节的数据，设备轮流获取通道使用权。
3. 数据宽度：单字节
4. 适用范围：**大量低速设备**，如光电机。
4. 特点：字符的传输时间短，但等待时间长。



#### 选择通道

选择通道的工作方式、数据宽度、适用范围：

1. 工作方式：独占通道；
2. 传输原理：选择好设备后，待所有数据传输完毕后才释放通道通道使用权；
3. 数据宽度：**可变长块**；
4. 适用范围：适合连接**优先级高的高速设备**，如磁盘。
4. 特点：独占通道，一次只能执行一个通道程序。



#### 数组多路通道

数组多路通道的工作方式、数据宽度、适用范围：

1. 工作方式：成组交叉；
2. 传输原理：选择好设备后，按固定字节数传送数据，传送完毕后释放通道使用权；
3. 数据宽度：**定长块**；
4. 适用范围：适合连接**高速设备**，如磁盘。
4. 特点：传输速率高，但**传输前的寻址辅助操作时间长**。





### 流量分析 （应）

**通道流量**：单位时间内能够传送的最大数据量，又称通道吞吐率，通道数据传输率等。

**通道最大流量**：通道在满负荷工作状态下的流量。



#### 极限流量

![image-20220714130752090](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/e6c9d24egy1h4q6c1tg07j216w0o6415.jpg)

#### 实际流量

![image-20220714130914216](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/e6c9d24egy1h4q6c42qzzj20uc0eudh6.jpg)

#### **极限与实际流量的关系**

![image-20220714130953241](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/e6c9d24egy1h4q6c4lkeuj219w0cu75s-20230211165927496.jpg)





#### 计算题【***】

通道流量的计算套路掌握得不是很好，如：1304、1604#28、1910#27、2110#28

> 本例经常考，同时注意单位换算 
>
> ![IMG_9422](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/IMG_9422.jpeg)
>
> ![IMG_9423](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/IMG_9423.jpeg)



### 流量设计 * ** 

通道流量的设计，需要考虑**信息丢失问题**。当实际流量非常接近极限流量时，有可能出现信息丢失问题。因为高速设备在频繁发出传输数据请求时，总是优先得到响应和处理，这时低速设备的信息可能因为得不到及时处理而被丢弃。为此，解决这一问题的办法：给设备配置**缓冲器**，来**暂存**无法及时处理的信息或动态改变设备响应的**优先级**来弥补。

