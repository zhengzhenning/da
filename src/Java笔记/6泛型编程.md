---
author: æŒ¯æŒ¯
title: æ³›å‹ç¼–ç¨‹
order: 6
icon: file
date: 2022-11-10
category:
  - Java
---
# æ³›å‹ç¼–ç¨‹ `JDK5`

æœ‰**ä¸€ä¸ª**æˆ–å¤šä¸ª**ç±»å‹å‚æ•°**çš„ç±»æˆ–æ¥å£ï¼Œç§°ä¸ºæ³›å‹ï¼›æ³›å‹å‡ºç°åï¼Œæé«˜äº†ä»£ç çš„å¤ç”¨æ€§ï¼Œå› ä¸ºå…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šåªéœ€è¦å‘Šè¯‰ç¼–è¯‘å™¨ä½¿ç”¨ä»€ä¹ˆç±»å‹ï¼Œå‰©ä¸‹çš„ç»†èŠ‚äº¤ç”±ç¼–è¯‘å™¨å¤„ç†å³å¯ã€‚

- ğŸ”— [Angelika Langer çš„ã€ŠJava Generics FAQsã€‹](http://www.angelikalanger.com/GenericsFAQ/JavaGenericsFAQ.html)
- ğŸ”— [ä¸€æ–‡è¯»æ‡‚ï¼Œä»€ä¹ˆæ˜¯æ³›å‹ç¼–ç¨‹](https://baijiahao.baidu.com/s?id=1711439995328875937&wfr=spider&for=pc)

# å®è·µåŸåˆ™ 

å¯¹äºæ³›å‹çš„ä½¿ç”¨ï¼Œã€ŠEffective Javaã€‹æäº†8ç‚¹å»ºè®®ï¼š
1. ä¸è¦ä½¿ç”¨åŸç”Ÿæ€ç±»å‹
2. è®°å¾—æ¶ˆé™¤éå—æ£€çš„è­¦å‘Š
3. èƒ½ç”¨é›†åˆçš„ç»ä¸ç”¨æ•°ç»„
4. ä¼˜å…ˆè€ƒè™‘æ³›å‹
5. ä¼˜å…ˆè€ƒè™‘æ³›å‹æ–¹æ³•
6. åˆ©ç”¨æœ‰é™é€šé…ç¬¦æå‡APIçµæ´»æ€§
7. è°¨æ…å¹¶ç”¨æ³›å‹å’Œå¯å˜å‚æ•°
8. ä¼˜å…ˆè€ƒè™‘æ³›å‹å®‰å…¨çš„å¼‚æ„å®¹å™¨

## ä¸ä½¿ç”¨åŸç”Ÿæ€ç±»å‹

èƒ½ç”¨æ³›å‹çš„ï¼Œç»ä¸ç”¨åŸç”Ÿæ€ç±»å‹ã€‚å› ä¸ºä½¿ç”¨**åŸç”Ÿæ€ç±»å‹**ä¼šå¤±æ‰æ³›å‹çš„**å®‰å…¨æ€§**å’Œ**æè¿°æ€§**ä¸¤å¤§ç‰¹æ€§ã€‚ä½¿ç”¨åŸç”Ÿæ€ç±»å‹å®¹æ˜“åœ¨è¿è¡Œæ—¶æŠ¥å¼‚å¸¸ï¼Œ**åŸç”Ÿæ€ç±»å‹**å­˜åœ¨åªæ˜¯ä¸ºäº†**å…¼å®¹æ³›å‹å¼•å…¥ä¹‹å‰çš„é—ç•™ä»£ç **ã€‚

```java
List<E> // æ³›å‹çš„Listé›†åˆ
List // åŸç”Ÿæ€ç±»å‹çš„Listé›†åˆ
```

List å’Œ ``List<Object>`` æ˜¯æœ‰åŒºåˆ«çš„ï¼šListï¼Œä¸è¿›è¡Œæ³›å‹æ£€æŸ¥ï¼›`List<Object>`è¦è¿›è¡Œæ³›å‹æ£€æŸ¥ï¼Œè¡¨ç¤ºå‘ŠçŸ¥ç¼–è¯‘å™¨Listå¯ä»¥æŒæœ‰ä»»æ„å¯¹è±¡ã€‚

| æœ¯è¯­             | ç¤ºä¾‹                               |
| ---------------- | ---------------------------------- |
| å‚æ•°åŒ–çš„ç±»å‹     | `List<String>`                     |
| å®é™…ç±»å‹å‚æ•°     | String                             |
| æ³›å‹             | `List<E>`                          |
| å½¢å¼ç±»å‹å‚æ•°     | E                                  |
| æ— é™åˆ¶é€šé…ç¬¦ç±»å‹ | `List<?>`                          |
| åŸç”Ÿæ€ç±»å‹       | `List`                             |
| æœ‰é™åˆ¶ç±»å‹å‚æ•°   | `<E extends Number>`               |
| é€’å½’ç±»å‹é™åˆ¶     | `<T extends Comparable<T>>`        |
| æœ‰é™åˆ¶é€šé…ç¬¦ç±»å‹ | `List<? extends Number>`           |
| æ³›å‹æ–¹æ³•         | `static <E> List<E> asList(E[] a)` |
| ç±»å‹ä»¤ç‰Œ         | String.class                       |

## æ¶ˆé™¤éå—æ£€çš„è­¦å‘Š

> æ¶ˆé™¤éå—æ£€çš„è­¦å‘Š(unchecked xx warning)
>

å…ˆä¿è¯ä»£ç æ˜¯**ç±»å‹å®‰å…¨çš„**ï¼Œå†æ¶ˆé™¤éå—æ£€è­¦å‘Šã€‚

åœ¨ä»£ç ä¸­ä½¿ç”¨`@SuppressWarning("unchecked")`è§£é™¤è­¦å‘Šï¼Œä½†å¿…é¡»ç¡®ä¿ç±»å‹å®‰å…¨ï¼Œå¦åˆ™ä¸€æ ·è¦æŠ›CCEå¼‚å¸¸ã€‚è¿™æ ·å¯ä»¥é¿å…`Class Cast Exception`å¼‚å¸¸ã€‚ 

ã€ä¾‹ã€‘`JDK` ä¸­ä½¿ç”¨äº† `@SuppressWarning("unchecked")` çš„ä¸€ä¸ªå®˜æ–¹ä»£ç ç¤ºä¾‹ï¼š**ArrayList** `public <T> T[] toArray(T[] a)` 

```java
 @SuppressWarnings("unchecked")
 public <T> T[] toArray(T[] a) {
     if (a.length < size)
         // Make a new array of a's runtime type, but my contents:
         return (T[]) Arrays.copyOf(elementData, size, a.getClass());
     System.arraycopy(elementData, 0, a, 0, size);
     if (a.length > size)
         a[size] = null;
     return a;
 }
```

<b style="color:green">æ¶ˆé™¤éå—æ£€è­¦å‘Šï¼š</b>éå—æ£€è­¦å‘Šæ„å‘³ç€å¯èƒ½å­˜åœ¨è¿è¡Œæ—¶CCEå¼‚å¸¸ã€‚

è¦æ¶ˆé™¤è¿™äº›å¼‚å¸¸ï¼Œæœ€å¤§ç¨‹åº¦ä¿è¯ä»£ç æ˜¯ç±»å‹å®‰å…¨çš„ï¼Œå…¶ä¸­æœ‰**ä¸¤ç§æ–¹å¼**ï¼š

1. é€šè¿‡ `<>` æ¶ˆé™¤è­¦å‘Š
2. ä½¿ç”¨ `@SuppressWarnings("unchecked")` å¿½è§†è­¦å‘Šï¼Œå¹¶åœ¨æ³¨é‡Šä¸­è¯´æ˜è¿™ä¹ˆåšçš„åŸå› 

```java
// é€šè¿‡<>æ¶ˆé™¤è­¦å‘Š
Set<Lark> items=new HashSet(); // æœ‰éå—æ£€çš„è­¦å‘Š
Set<Lark> items=new HashSet<>(); // æ²¡æœ‰éå—æ£€çš„è­¦å‘Š
```

## <b style="color:red">èƒ½ç”¨é›†åˆçš„ç»ä¸ç”¨æ•°ç»„</b>

é›†åˆï¼Œæ˜¯åœ¨ç¼–è¯‘æ—¶æ£€æŸ¥å…ƒç´ ç±»å‹çš„åˆæ³•æ€§ï¼Œè€Œæ•°ç»„æ˜¯åœ¨è¿è¡Œæ—¶æ£€æŸ¥å…ƒç´ ç±»å‹çš„åˆæ³•æ€§ã€‚é›†åˆè£…çš„æ˜¯ä¸€ç±»å…ƒç´ ï¼Œæ•°ç»„å¯ä»¥è£…å¤šç±»å…ƒç´ ï¼Œæ¯”å¦‚ï¼š

```java
Object[] objArray=new Long[1];
objArray[0]="yibu"; // è¿è¡Œæ—¶ï¼ŒæŠ›å‡º ArrayStoreExceptionå¼‚å¸¸
```

å¦‚æœæ¢æˆé›†åˆï¼š

```java
ArrayList<Long> list=new ArrayList<>();
list.add("yibu"); //  æ— æ³•é€šè¿‡ç¼–è¯‘ï¼Œå› ä¸ºliståªæ¥å—Longç±»å‹çš„å…ƒç´ 
```

ä½¿ç”¨æ•°ç»„æ—¶ï¼Œå¾—ç­‰åˆ°è¿è¡Œæ—¶æ‰èƒ½å‘ç°é”™è¯¯ï¼Œè€Œä½¿ç”¨é›†åˆï¼Œåœ¨ç¼–è¯‘æ—¶å°±èƒ½å‘ç°é”™è¯¯ã€‚å› æ­¤ï¼Œè£…å…ƒç´ æ—¶ï¼Œèƒ½ç”¨é›†åˆçš„ç»ä¸ç”¨æ•°ç»„ã€‚

åŒæ—¶ï¼Œè®°ä½ï¼šâ€œæ— æ³•åˆ›å»ºæ³›å‹æ•°ç»„ã€å‚æ•°åŒ–ç±»å‹çš„æ•°ç»„ã€ç±»å‹å‚æ•°çš„æ•°ç»„â€ï¼Œç®€è€Œè¨€ä¹‹ï¼š**æ³›å‹ã€æ•°ç»„ä¸èƒ½ç»„åˆåˆ°ä¸€å—ä½¿ç”¨ï¼ï¼ï¼**

```java
new List<E>[]; // âŒ
new List<String>[]; // âŒ
new E[]; // âŒ
```

ä¸èƒ½ç»„åˆåˆ°ä¸€å—ä½¿ç”¨çš„åŸå› ï¼šè§ã€ŠEffective Javaã€‹ï¼ˆ3thï¼‰ç¬¬109é¡µï¼Œæœ‰å…·ä½“åˆ†æå®ä¾‹ï¼Œæ­¤å¤„ä¸èµ˜è¿°ã€‚å…¶æ ¸å¿ƒåŸç†æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š

1. æ³›å‹çš„æ“¦é™¤ç‰¹æ€§
2. æ•°ç»„çš„åå˜ç‰¹æ€§
3. Objectçš„è¶…ç±»ç‰¹æ€§
4. ç¼–è¯‘æ—¶ã€è¿è¡Œæ—¶ç‰¹æ€§



# æ³›å‹ç±»



# æ³›å‹æ¥å£

å¯ä»¥é€šè¿‡java8çš„`Supplier`ç±»ï¼Œäº†è§£**æ³›å‹æ¥å£**æ¦‚å¿µï¼šå£°æ˜æ³›å‹æ¥å£ã€‚

```java
package java.util.function;

@FunctionalInterface
public interface Supplier<T> {
    T get();
}
```

# æ³›å‹æ–¹æ³•

å£°æ˜æ³›å‹æ–¹æ³•çš„æ—¶ï¼Œæœ‰1ä¸ªåŸåˆ™è¦éµå¾ªï¼šå°½å¯èƒ½åœ°æŠŠæ³›å‹èŒƒå›´ç¼©å°åˆ°æ–¹æ³•çº§ä¸Šã€‚å› ä¸ºå°†å•ä¸ªæ–¹æ³•æ³›å‹åŒ–ï¼Œæ¯”å°†æ•´ä¸ªç±»æ³›å‹åŒ–ï¼Œæ›´æ¸…æ™°æ˜“æ‡‚ã€‚

åœ¨å“ªé‡Œå£°æ˜æ³›å‹æ–¹æ³•ï¼Ÿæœ‰2ä¸ªåœ°æ–¹å¯ä»¥å£°æ˜ï¼Œä¸€ä¸ªæ˜¯æ³›å‹ç±»ï¼ˆæ¥å£ï¼‰ï¼Œä¸€ä¸ªæ˜¯æ™®é€šç±»ï¼ˆæ¥å£ï¼‰ã€‚

å£°æ˜æ³›å‹æ–¹æ³•æ—¶ï¼Œæœ‰3ç§å£°æ˜å½¢å¼ï¼š

1. æ™®é€šæ–¹æ³•çš„æ³›å‹
2. é™æ€æ–¹æ³•çš„æ³›å‹ï¼Œæœ‰å±€é™æ€§ã€‚
3. å¸¦æœ‰å¯å˜é•¿å‚æ•°(T...args)çš„æ³›å‹æ–¹æ³•



## æ™®é€šæ–¹æ³•çš„æ³›å‹

```java
public interface BaseVioService {
	/**
   * ã€åŠŸèƒ½ã€‘é‡å¤æ•°æ®éªŒè¯
   *
   * @param t å®ä¾‹
   * @return æœ‰åˆ™trueï¼Œæ— åˆ™false
   */
  <T extends ViolationPO> Boolean checkRepeatVio(T t);
}
```



## é™æ€æ–¹æ³•çš„æ³›å‹

åœ¨ç±»é‡Œå£°æ˜é™æ€æ–¹æ³•çš„æ³›å‹ï¼š

```java
public class UserProfileServiceImpl {
 		public static <T extends UserProfile> void staticAdd(T t) {
        System.err.println(t);
    }
}    
```

åœ¨æ¥å£é‡Œå£°æ˜é™æ€æ–¹æ³•çš„æ³›å‹ï¼š

```java
public interface UserProfileServiceI {
    public static <T> void staticAdd(T t) {
        System.err.println(t);
    }
}
```



## å¸¦æœ‰å¯å˜é•¿å‚æ•°(T...args)çš„æ³›å‹æ–¹æ³•

```java
public class GenericVarargs {
    @SafeVarargs
    public static <T> List<T> makeList(T... args) {
        List<T> result = new ArrayList<>();
        for (T item : args)
            result.add(item);
        return result;
    }
}
```







# ç±»å‹æ“¦é™¤ *

åœ¨**ç¼–è¯‘æ—¶å¼ºåŒ–**ç±»çš„ç±»å‹ä¿¡æ¯ï¼Œåœ¨**è¿è¡Œæ—¶æ“¦é™¤**ç±»çš„ç±»å‹ä¿¡æ¯ã€‚

é€šè¿‡è¿™ä¸ªä¾‹å­ï¼Œå¯ä»¥çœ‹åˆ°â€œç±»å‹æ“¦é™¤â€æ•ˆæœï¼š

```java
    public static void main(String[] args) {
        Class c1 = new Array`List<String>`().getClass();
        Class c2 = new ArrayList<Integer>().getClass();
        System.out.println(c1 == c2);
    } // è¾“å‡º true
```

# è¡¥å¿æ“¦é™¤

ç±»å‹æ“¦é™¤ä¹‹åï¼Œä¸èƒ½è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š

```java
public class Erased<T> {
    private final int SIZE = 100;

    public void f(Object arg) {
        // error: illegal generic type for instanceof
        if (arg instanceof T) {
        }
        // error: unexpected type
        T var = new T();
        // error: generic array creation
        T[] array = new T[SIZE];
        // warning: [unchecked] unchecked cast
        T[] array = (T[]) new Object[SIZE];

    }
}
```

å› ä¸ºï¼Œç±»å‹æ“¦é™¤æœºåˆ¶ä½¿ç±»ä¸¢å¤±äº†**ç±»å‹ä¿¡æ¯**ã€‚

å¦‚æœæœ‰è¿™ä¸¤ç±»éœ€æ±‚ï¼š

1. æƒ³è¦çŸ¥é“ç±»çš„å…·ä½“ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡Classç±»çš„`isInstance()`è¿›è¡Œåˆ¤æ–­ï¼š

```java
public native boolean isInstance(Object obj);
```

2. æƒ³è¦åœ¨æ³›å‹ç‰¹æ€§ä¸‹åˆ›å»ºç±»çš„å…·ä½“å®ä¾‹ï¼Œå¯ä»¥é€šè¿‡ï¼š

- å®ç° `Supplier<T>`
- æˆ– æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼

> å®ç°`Supplier<T>`

```java
// generics/FactoryConstraint.java

import onjava.Suppliers;

import java.util.ArrayList;
import java.util.List;
import java.util.function.Supplier;

// æ–¹å¼ä¸€
class IntegerFactory implements Supplier<Integer> {
    private int i = 0;

    @Override
    public Integer get() {
        return ++i;
    }
}

// æ–¹å¼äºŒï¼šå†…éƒ¨ç±»ï¼š new Widget.Factory()
class Widget {
    private int id;

    Widget(int n) {
        id = n;
    }

    @Override
    public String toString() {
        return "Widget " + id;
    }

    public static
    class Factory implements Supplier<Widget> {
        private int i = 0;

        @Override
        public Widget get() {
            return new Widget(++i);
        }
    }
}

// æ–¹å¼ä¸‰ï¼š Fudge::new
class Fudge {
    private static int count = 1;
    private int n = count++;

    @Override
    public String toString() {
        return "Fudge " + n;
    }
}

class Foo2<T> {
    private List<T> x = new ArrayList<>();

    Foo2(Supplier<T> factory) {
        Suppliers.fill(x, factory, 5);
    }

    @Override
    public String toString() {
        return x.toString();
    }
}

public class FactoryConstraint {
    public static void main(String[] args) {
        System.out.println(
                new Foo2<>(new IntegerFactory()));
        System.out.println(
                new Foo2<>(new Widget.Factory()));
        System.out.println(
                new Foo2<>(Fudge::new));
    }
}
/* Output:
[1, 2, 3, 4, 5]
[Widget 1, Widget 2, Widget 3, Widget 4, Widget 5]
[Fudge 1, Fudge 2, Fudge 3, Fudge 4, Fudge 5]
*/
```

â€‹	

# é€šé…ç¬¦

- æ— é™é€šé…ç¬¦
- æœ‰é™é€šé…ç¬¦

`<? extends Fruit>`ï¼šè¯»ä½œï¼šâ€œä¸€ä¸ªå…·æœ‰ä»»ä½•ä»Fruitç»§æ‰¿çš„ç±»å‹çš„åˆ—è¡¨â€ã€‚

`Set<?>ã€List<ï¼Ÿ>` è¯»ä½œï¼šâ€œæŸä¸ªç±»å‹çš„é›†åˆâ€ã€‚

`Set` å’Œ `Set<?>` æ˜¯æœ‰åŒºåˆ«çš„ï¼š`Set` æ˜¯ç±»å‹ä¸å®‰å…¨çš„ï¼›`Set<?>`æ˜¯ç±»å‹å®‰å…¨çš„ã€‚ 