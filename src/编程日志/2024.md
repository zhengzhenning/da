---
head:
  - - meta
    - name: æ—¥å¿—
      content: å¼€å‘æ—¥å¿—
---

> [!important]
> é‡è¦æ–‡å­—

> [!info]
> ä¿¡æ¯æ–‡å­—

> [!tip]
> æç¤ºæ–‡å­—

> [!warning]
> æ³¨æ„æ–‡å­—

> [!caution]
> è­¦å‘Šæ–‡å­—

> [!note]
> æ³¨é‡Šæ–‡å­—

# 2024 å¹´æ—¥å¿—

## 12æœˆæ—¥å¿—

> [!tip]
>
> `SpringBoot` `Nacos`
>
> Nacos å‘ç°æ³¨å†Œå¯ä»¥é€šè¿‡å‘½åç©ºé—´ `namespace` å’Œ åˆ†ç»„ `group` å‚æ•°è¿›è¡Œéš”ç¦»ï¼Œå¯ä»¥å¾ˆå¥½åœ°å®ç°ç¯å¢ƒéš”ç¦»ï¼Œå°¤å…¶æ˜¯åœ¨æ¥å£è°ƒè¯•ä¸Šä¼šéå¸¸æœ‰ç”¨ã€‚
>
> åŸºäº IDEA å¯ä»¥é€šè¿‡å¯åŠ¨å‚æ•°è¿›è¡Œç»Ÿä¸€é…ç½®ï¼š
>
> ```
> spring.cloud.nacos.discovery.namespace=zzn;spring.profiles.active=dev;spring.cloud.nacos.discovery.group=zzn
> ```
>
> ![IDEA-SpringBootå¯åŠ¨å‚æ•°é…ç½®](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/image-20241212170254171.png)

> [!important]
>
> åœ¨å¾®æœåŠ¡ç¯å¢ƒä¸­å¿…ç„¶ä¼šé¢ä¸´çš„**æœåŠ¡å‘ç°**ã€**è¿œç¨‹è°ƒç”¨**ã€**è´Ÿè½½å‡è¡¡**ã€**é›†ä¸­é…ç½®**ç­‰éåŠŸèƒ½æ€§çš„éœ€æ±‚ã€‚

> [!note]
>
> `å‡¤å‡°æ¶æ„`
>
> å°ä¹¦åº— Fenix's Bookstore çš„æ¶æ„æ¼”è¿›ï¼š
> å•ä½“æ¶æ„ï¼š
>
> ![ddd-arch](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/ddd-arch.png)
>
> åŸºäº Spring Cloud çš„å¾®æœåŠ¡æ¶æ„ï¼š
>
> - ä¼˜åŠ¿
> - åŠ£åŠ¿
>
> ![springcloud-ms](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/springcloud-ms.png)
>
> åŸºäº Kubernetes çš„å¾®æœåŠ¡æ¶æ„ï¼š
>
> ![kubernetes-ms](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/kubernetes-ms.png)
>
> åŸºäº Istio çš„æœåŠ¡ç½‘æ ¼æ¶æ„ï¼š
>
> ![istio-ms](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/istio-ms.png)
>
> 
>
> 
>
> 

> [!note]
>
> `k6`
>
> æ¥å£å‹æµ‹å¯¹æ¯”ç»“è®ºï¼šæœ‰å¤šçº§ç¼“å­˜çš„å“åº”é€Ÿåº¦æ˜¯æ— å¤šçº§ç¼“å­˜çš„ 6 å€å·¦å³ï¼Œå³å“åº”é€Ÿåº¦æ›´å¿«ï¼Œå› æ­¤åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œå¤šçº§ç¼“å­˜ç­–ç•¥æ˜¯å¿…è¦çš„ã€‚
>
> ![k6-Grafna](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/image-20241210162357614.png)
>
> å¯¹åº”ç¤ºä¾‹ä»£ç ï¼š
>
> ```java
> 		// æœ‰å¤šçº§ç¼“å­˜ç­–ç•¥
>  public List<FirepowerInfoDO> listAllByMultiLevelCache() {
>      List<FirepowerInfoDO> items = Lists.newArrayList();
>      long start = System.currentTimeMillis();
> 
>      items = LocalCache.get(LOCAL_CACHE_KEY);
>      if (CollectionUtil.isNotEmpty(items)) {
>          log.info(LOG + "æœ¬åœ°ç¼“å­˜å–æ•°ï¼Œè€—æ—¶:{}(ms)", System.currentTimeMillis() - start);
>          return items;
>      }
> 
>      if (redisTemplate.hasKey(REDIS_CACHE_KEY)) {
>          String giftCache = (String) redisTemplate.opsForValue().get(REDIS_CACHE_KEY);
>          items = JSON.parseArray(giftCache, FirepowerInfoDO.class);
>          log.info(LOG + "Redisç¼“å­˜å–æ•°ï¼Œè€—æ—¶:{}(ms)", System.currentTimeMillis() - start);
>          LocalCache.put(LOCAL_CACHE_KEY, items);
>          return items;
>      }
>      items = this.list();
>      sync2MultiLevelCache("è·å–ç«åŠ›å€¼ä¿¡æ¯åˆ—è¡¨ï¼ˆå¤šçº§ç¼“å­˜ï¼‰", items);
>      log.info(LOG + "æ•°æ®åº“å–æ•°ï¼Œè€—æ—¶ï¼š{}(ms)", System.currentTimeMillis() - start);
>      return items;
>  }
> ```
>
> ```java
> 		// æ— å¤šçº§ç¼“å­˜ç­–ç•¥
>  public List<FirepowerInfoDO> listAll() {
>      return this.list();
>  }
> ```



> [!info] 
>
> `å¹¶å‘`
>
> å¹¶å‘ç›¸å…³æœ¯è¯­ï¼šçº¿ç¨‹ã€è¿›ç¨‹ã€å¤šçº¿ç¨‹ã€å¹¶å‘ä¸å¹¶è¡Œã€åŒæ­¥ä¸å¼‚æ­¥ã€æ­»é”ã€è™šæ‹Ÿçº¿ç¨‹ï¼ˆJDK21ï¼‰ã€JAVAå†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰ã€volatileå…³é”®å­—ã€ä¹è§‚é”ä¸æ‚²è§‚é”ã€CASç®—æ³•ã€synchronizedå…³é”®å­—ã€å…¬å¹³é”ä¸éå…¬å¹³é”ã€å…±äº«é”ä¸ç‹¬å é”ã€ThreadLocalç±»ã€çº¿ç¨‹æ± ï¼ˆæ± åŒ–æŠ€æœ¯ï¼‰ã€Futureã€æŠ½è±¡é˜Ÿåˆ—åŒæ­¥å™¨AQSï¼ˆAbstractQueuedSynchronizerï¼‰ã€è™šæ‹Ÿçº¿ç¨‹ã€Executor ä¸ ThreadPoolExecutorã€‚

> [!important]
>
>  `Java` `String` `æœ€ä½³å®è·µ`
>
> **String å®è·µåŸåˆ™**
>
> Stringã€StringBuilderã€StringBuffer åœ¨æ—¥å¸¸å¼€å‘ä¸­å±äºé«˜é¢‘ä½¿ç”¨çš„ç±»ï¼Œå…·ä½“ç”¨å“ªä¸ªï¼Œè¦éµå®ˆä»¥ä¸‹åŸåˆ™ï¼š
>
> åŸåˆ™1ï¼šæ“ä½œå°‘é‡çš„æ•°æ®: é€‚ç”¨ `String`
>
> åŸåˆ™2ï¼š**å•çº¿ç¨‹**æ“ä½œå­—ç¬¦ä¸²ç¼“å†²åŒºä¸‹æ“ä½œå¤§é‡æ•°æ®: é€‚ç”¨ `StringBuilder` 
>
> åŸåˆ™3ï¼š**å¤šçº¿ç¨‹**æ“ä½œå­—ç¬¦ä¸²ç¼“å†²åŒºä¸‹æ“ä½œå¤§é‡æ•°æ®: é€‚ç”¨ `StringBuffer`
>
> **ç®€è¨€ä¹‹ï¼šä¸€çœ‹æ•°æ®é‡ã€äºŒçœ‹çº¿ç¨‹æ•°**

> [!info]
>
> `SpringBoot 2.3.4.RELEASE`  `RabbitMQ 3.12.14` `Erlang 25.3.2.13`
>
> å®ç°è‡ªåŠ¨æäº¤ï¼ˆACKï¼‰+æœ‰é™æ¬¡é‡è¯•+æ­»ä¿¡é˜Ÿåˆ—å­˜å‚¨æ¶ˆè´¹å¤±è´¥æ¶ˆæ¯ï¼Œæ€è·¯ï¼š
>
> 1. `yml` é…ç½®æ–‡ä»¶é…ç½® rabbitmq å±æ€§ã€æ­»ä¿¡ç›¸å…³çš„è·¯ç”±é”®ã€äº¤æ¢åŒºä»¥åŠé˜Ÿåˆ—
> 2. åŸºäº JavaConfig ç±»çš„é…ç½®ï¼ˆå¦‚ï¼šRabbitGiftConsumptionConfig.javaï¼‰ï¼Œéœ€é…ç½®é‡è¯•ç­–ç•¥
> 3. åŸºäº JavaConfig ç±»çš„é…ç½®ï¼ˆå¦‚ï¼šRabbitGiftConsumptionConfig.javaï¼‰ï¼Œéœ€åœ¨ @RabbitListener#containerFactory å£°æ˜ä¸­æŒ‡å®šè‡ªå®šä¹‰é…ç½®ç±»
> 4. ç¼–å†™ä¸šåŠ¡é˜Ÿåˆ—ç›‘å¬æ–¹æ³•ï¼Œå¦‚ï¼šGiftPresentConsumptionListener#
> 5. ç¼–å†™æ­»ä¿¡é˜Ÿåˆ—ç›‘å¬æ–¹æ³•
> 6. æµç¨‹éªŒè¯
>
> ç¤ºä¾‹ä»£ç ï¼š
>
> # ä¸€ã€é…ç½®æ–‡ä»¶
>
> ```yml
> spring:
>   # rabbitmq
>   rabbitmq:
>     host: ***********
>     port: 5672
>     username: dreamer
>     password: dreamer
>     virtual-host: /dreamer
>     # ç”Ÿäº§è€… ==> EXCHANGE ç¡®è®¤æ–¹å¼
>     publisher-confirm-type: correlated
>     # EXCHANGE ===> QUEUE è¿”å›ç±»å‹
>     publisher-returns: true
>     listener:
>       simple:
>         # è‡ªåŠ¨ç¡®è®¤æ¨¡å¼
>         acknowledge-mode: auto
>         # å†³å®šç”±äºç›‘å¬å™¨æŠ›å‡ºå¼‚å¸¸è€Œæ‹’ç»çš„æ¶ˆæ¯æ˜¯å¦è¢«é‡æ–°æ”¾å›é˜Ÿåˆ—ã€‚é»˜è®¤å€¼ä¸º trueï¼Œé‡æ–°æ”¾å›é˜Ÿåˆ—ã€‚è¿™é‡Œè®¾ç½®ä¸º falseï¼Œå¦‚æœå¤šæ¬¡é‡è¯•è¿˜æ˜¯å¼‚å¸¸å°±è½¬å‘åˆ°æ­»ä¿¡é˜Ÿåˆ—
>         default-requeue-rejected: false
>         # é…ç½®é‡è¯•
>         retry:
>           # å¼€å¯é‡è¯•
>           enabled: true
>           # æ¶ˆæ¯æœ€å¤šé‡è¯•5æ¬¡
>           max-attempts: 5   
>           # æ¶ˆæ¯å¤šæ¬¡æ¶ˆè´¹çš„é—´éš”2ç§’
>           initial-interval: 2000    
>           # æœ€å¤§å…è®¸é‡è¯•æ—¶é—´
>           max-interval: 30000
>           # ä¸‹ä¸€æ¬¡é‡è¯•çš„æ—¶é—´é—´éš” = ä¸Šæ¬¡é‡è¯•æ—¶é—´é—´éš” * multiplier
>           multiplier: 2
> ```
>
> # äºŒã€é…ç½®ç±»
>
> ```java
> package com.hnzmr.product.core.config;
> 
> import lombok.Data;
> import lombok.extern.slf4j.Slf4j;
> import org.springframework.amqp.core.*;
> import org.springframework.amqp.rabbit.config.RetryInterceptorBuilder;
> import org.springframework.amqp.rabbit.config.SimpleRabbitListenerContainerFactory;
> import org.springframework.amqp.rabbit.connection.CachingConnectionFactory;
> import org.springframework.amqp.rabbit.retry.RejectAndDontRequeueRecoverer;
> import org.springframework.amqp.support.converter.Jackson2JsonMessageConverter;
> import org.springframework.beans.factory.annotation.Autowired;
> import org.springframework.beans.factory.annotation.Value;
> import org.springframework.context.annotation.Bean;
> import org.springframework.context.annotation.Configuration;
> import org.springframework.retry.interceptor.RetryOperationsInterceptor;
> 
> 
> @Slf4j
> @Data
> @Configuration
> public class RabbitGiftConsumptionConfig {
> 
>     public static final String LOG = "[ç¤¼ç‰©æ‰“èµæ¶ˆè´¹é…ç½®ç±»]";
> 
>     @Value("${product.gift.consumption.routingkey}")
>     private String productGiftConsumptionRoutingkey;
> 
>     @Value("${product.fanout.exchange}")
>     private String productFanoutExchange;
> 
>     @Bean
>     public Exchange giftConsumptionQueueExchange() {
>         return new FanoutExchange(productFanoutExchange);
>     }
> 
>     @Autowired
>     CachingConnectionFactory cachingConnectionFactory;
> 
>     /**
>      * *************************************************
>      * ********** ç¤¼ç‰©æ‰“èµ2.0é˜Ÿåˆ—é…ç½® ********************
>      * *************************************************
>      */
> 
>     /**
>      * Versionï¼šæ‰“èµ2.0
>      * ç¤¼ç‰©èµ é€é˜Ÿåˆ—ï¼ˆä»ç¤¼ç‰©ç•Œé¢é€å‡ºçš„ï¼‰
>      */
>     @Value("${product.gift.consumption.presentQueue}")
>     private String productGiftConsumptionPresentQueue;
>     /**
>      * æœ€å¤§é‡è¯•æ¬¡æ•°
>      */
>     @Value("${spring.rabbitmq.listener.simple.retry.max-attempts}")
>     private Integer retryMaxAttempts;
>     /**
>      * åˆå§‹é‡è¯•æ—¶é—´
>      */
>     @Value("${spring.rabbitmq.listener.simple.retry.initial-interval}")
>     private Integer retryInitialInterval;
>     /**
>      * æœ€å¤§é‡è¯•æ—¶é—´
>      */
>     @Value("${spring.rabbitmq.listener.simple.retry.max-interval}")
>     private Integer retryMaxInterval;
>     /**
>      * é‡è¯•æ—¶é—´å› å­
>      */
>     @Value("${spring.rabbitmq.listener.simple.retry.multiplier}")
>     private Integer retryMultiplier;
>     /**
>      * æ­»ä¿¡äº¤æ¢æœº
>      */
>     public static final String X_DEAD_LETTER_EXCHANGE = "x-dead-letter-exchange";
>     /**
>      * æ­»ä¿¡è·¯ç”±é”®
>      */
>     public static final String X_DEAD_LETTER_ROUTING_KEY = "x-dead-letter-routing-key";
> 
>     @Bean
>     public Queue giftConsumptionPresentQueue() {
>         // ç»‘å®šæ­»ä¿¡é˜Ÿåˆ—
>         return QueueBuilder.durable(productGiftConsumptionPresentQueue)
>                 .withArgument(X_DEAD_LETTER_EXCHANGE, deadLetterExchange)
>                 .withArgument(X_DEAD_LETTER_ROUTING_KEY, deadLetterRoutingKey)
>                 .build();
>     }
> 
>     @Bean
>     public Binding giftConsumptionPresentBinding() {
>         return BindingBuilder.bind(giftConsumptionPresentQueue())
>                 .to(giftConsumptionQueueExchange())
>                 .with(productGiftConsumptionRoutingkey).noargs();
>     }
> 
>     @Bean
>     SimpleRabbitListenerContainerFactory giftPresentConsumerContainerFactory() {
>         SimpleRabbitListenerContainerFactory factory = new SimpleRabbitListenerContainerFactory();
>         factory.setConnectionFactory(cachingConnectionFactory);
>         factory.setAcknowledgeMode(AcknowledgeMode.AUTO);
>         factory.setMessageConverter(new Jackson2JsonMessageConverter());
>         // é…ç½®å¹¶å‘çº¿ç¨‹æ•°
>         factory.setConcurrentConsumers(10);
>         // é…ç½®é‡è¯•ç­–ç•¥
>         factory.setAdviceChain(retryInterceptor());
>         return factory;
>     }
> 
>     @Bean
>     public RetryOperationsInterceptor retryInterceptor() {
>         RetryOperationsInterceptor retryOperationsInterceptor = RetryInterceptorBuilder.stateless()
>                 .maxAttempts(retryMaxAttempts)
>                 .backOffOptions(retryInitialInterval, retryMultiplier, retryMaxInterval)
>                 .recoverer(new RejectAndDontRequeueRecoverer())
>                 .build();
>         log.info(LOG + "é‡è¯•ç­–ç•¥ï¼šmax-attempts=[{}];initial-interval=[{}];max-interval=[{}];multiplier=[{}]"
>                 , retryMaxAttempts, retryInitialInterval, retryMaxInterval, retryMultiplier);
>         return retryOperationsInterceptor;
>     }
> 
> 
>     /**
>      * *************************************************
>      * ********** ç¤¼ç‰©æ‰“èµæ­»ä¿¡é˜Ÿåˆ—é…ç½® ********************
>      * *************************************************
>      */
> 
>     @Value("${app.rabbitmq.exchange.common-dead-letter}")
>     private String deadLetterExchange;
>     @Value("${app.rabbitmq.queue.gift-present-dead-letter}")
>     private String deadLetterQueue;
>     @Value("${app.rabbitmq.routingKey.gift-present-dead-letter}")
>     private String deadLetterRoutingKey;
> 
>     /**
>      * æ­»ä¿¡äº¤æ¢æœº
>      *
>      * @return
>      */
>     @Bean
>     public Exchange deadLetterExchange() {
>         return new DirectExchange(deadLetterExchange);
>     }
> 
>     /**
>      * æ­»ä¿¡é˜Ÿåˆ—
>      *
>      * @return
>      */
>     @Bean
>     public Queue dealLetterQueue() {
>         return new Queue(deadLetterQueue);
>     }
> 
>     /**
>      * æ­»ä¿¡é˜Ÿåˆ—ä¸æ­»ä¿¡äº¤æ¢æœºç»‘å®š
>      *
>      * @return
>      */
>     @Bean
>     public Binding localDealLetterBinding() {
>         return BindingBuilder.bind(dealLetterQueue()).to(deadLetterExchange())
>                 .with(deadLetterRoutingKey).noargs();
>     }
> 
> }
> ```
>
> # ä¸‰ã€ç›‘å¬æ¶ˆè´¹
>
> ```java
> package com.hnzmr.product.core.listener;
> 
> 
> import lombok.extern.slf4j.Slf4j;
> import org.springframework.amqp.core.Message;
> import org.springframework.amqp.rabbit.annotation.RabbitListener;
> import org.springframework.stereotype.Component;
> import org.springframework.transaction.annotation.Transactional;
> 
> /**
>  * @program: dreamer
>  * @description: é€ç¤¼æ¶ˆè´¹ç›‘å¬
>  * @author: zzn
>  * @create: 2024-11-25 14:23
>  **/
> @Slf4j
> @Component
> public class GiftPresentConsumptionListener {
> 
>     @RabbitListener(
>             queues = "#{@rabbitGiftConsumptionConfig.productGiftConsumptionPresentQueue}"
>             , containerFactory = "giftPresentConsumerContainerFactory"
>     )
>     @Transactional(rollbackFor = Exception.class)
>     public void listenPersistQueue(Message msg) throws Exception {
>         // ä¸Šé”
>         // 1. å‚æ•°åˆè§„æ ¡éªŒ
>         // 2. æ•°æ®å¹‚ç­‰æ ¡éªŒ
>         // 3. ä¸šåŠ¡æ•°æ®å¤„ç†
>         // 4. å¤±è´¥å¼‚å¸¸æŠ›å‡ºè§¦å‘é‡è¯•æœºåˆ¶
>         // è§£é”
>         // ...
>     }
> 
> 
>     @RabbitListener(
>             queues = "#{@rabbitGiftConsumptionConfig.deadLetterQueue}"
>     )
>     @Transactional(rollbackFor = Exception.class)
>     public void DeadLetterListener(Message msg) throws Exception {
>         // å¤„ç†æ¶ˆè´¹å¤±è´¥çš„æ¶ˆæ¯....
>     }
> 
> }
> 
> ```
>
> 

> [!info]
>
> `SpringBoot` `RabbitMQ`
>
> [SpringBoot å®Œå…¨æ•´åˆ RabbitMQ + 100% å‘é€æ¶ˆæ¯ + é«˜å¯é æ¶ˆè´¹æ¶ˆæ¯ + æºç è§£æ](https://blog.csdn.net/wo18237095579/article/details/118695366)
>
> é‡‡ç”¨è‡ªåŠ¨ACK+æœ‰é™æ¬¡é‡è¯•+æ¨é€åˆ°æ­»ä¿¡é˜Ÿåˆ—çš„æ–¹å¼å­˜å‚¨æ¶ˆè´¹å¼‚å¸¸çš„æ¶ˆæ¯ã€‚

> [!info]
>
> `ç†è®ºåŸºç¡€` `æ•°æ®åº“` `äº‹åŠ¡`
>
> äº‹åŠ¡ï¼šå¯¹æ•°æ®æŒä¹…åŒ–æ—¶ï¼Œäº‹åŠ¡ä¿éšœäº†æŒä¹…åŒ–æ“ä½œæ»¡è¶³ï¼šâ€œè¦ä¹ˆå…¨éƒ¨æ‰§è¡ŒæˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œâ€çš„åŸåˆ™ã€‚
>
> å››å¤§ç‰¹æ€§ï¼šA C I D 
>
> - åŸå­æ€§ï¼ˆAï¼‰ï¼šäº‹åŠ¡ä¸å¯å†åˆ†
> - ä¸€è‡´æ€§ï¼ˆCï¼‰ï¼šæ‰§è¡Œäº‹åŠ¡åï¼Œæ•°æ®ä¸€è‡´
> - éš”ç¦»æ€§ï¼ˆIï¼‰ ï¼šäº‹åŠ¡ä¹‹é—´äº’ä¸å¹²æ‰°
> - æŒä¹…æ€§ï¼ˆDï¼‰ï¼šäº‹åŠ¡æäº¤åï¼Œæ•°æ®å³æŒä¹…åŒ–æˆåŠŸ
>
> AIDæ˜¯æ‰‹æ®µï¼ŒCæ˜¯ç›®çš„ï¼Œå³åªæœ‰ä¿è¯äº†äº‹åŠ¡çš„AIDåï¼ŒDæ‰èƒ½å¾—åˆ°ä¿éšœï¼š
>
> ![AID->C](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/008vxvgGgy1h7r7c3ca63j309r0ab0sw.jpg)

> [!info]
>
> `Docker` `k6` `Grafana` `InfluxDB`
>
> åŸºäº K6 å‹æµ‹æ¥å£æŒºå¥½ç”¨ã€‚
>
> ![Grafanaç•Œé¢](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/image-20241204140226072.png)

> [!info]
>
> `æ€§èƒ½æµ‹è¯•`
>
> æ€§èƒ½æµ‹è¯•è¡Œä¸šå¸¸ç”¨çš„æ€§èƒ½æŒ‡æ ‡è¡¨ç¤ºæ³•ï¼š
>
>  ![img](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/533fa609f8607dbd65878fb52ef87183-20241204111554907.jpg)
>
> [æ€ä¹ˆç†è§£TPSã€QPSã€RTã€ååé‡è¿™äº›æ€§èƒ½æŒ‡æ ‡ï¼Ÿ](https://time.geekbang.com/column/article/182772?utm_campaign=geektime_search&utm_content=geektime_search&utm_medium=geektime_search&utm_source=geektime_search&utm_term=geektime_search)
>
> 

> [!info]
>
> `Mac`  `SpringBoot`  `é€šç”¨`
>
> é‡åˆ° Web server failed to start. Port 9703 was already in use.
>
> ![image-20241204105414737](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/image-20241204105414737.png)
>
> å¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ€æ­»è¿›ç¨‹ï¼š
>
> ```shell
> lsof -i :9703 
> kill -9 <PID>
> ```
>
> å¦‚ï¼š
>
> ![image-20241204105340595](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/image-20241204105340595.png)
>
> æ‰§è¡Œå®Œåï¼Œé‡å¯ SpringBoot å·¥ç¨‹ã€‚
>
> å…¶ä»–åœºæ™¯ä¸‹çš„ç«¯å£å ç”¨ï¼ŒåŒæ ·é€‚ç”¨ã€‚

> [!info] 
>
> `æ•°æ®åº“ç†è®ºåŸºç¡€` `å¹¶å‘äº‹åŠ¡` `äº‹åŠ¡ä¼ æ’­çº§åˆ«`
>
> å¹¶å‘äº‹åŠ¡ï¼ˆè¶…è¿‡2ä¸ªäº‹åŠ¡æ“ä½œæ•°æ®ï¼‰å¼•èµ·è„è¯»ã€å¹»è¯»ã€ä¸å¯é‡å¤è¯»ã€ä¸¢å¤±æ›´æ–°4ç±»é—®é¢˜ï¼Œè¿™4ç±»é—®é¢˜å¯ä»¥é€šè¿‡è®¾ç½®äº‹åŠ¡ä¼ æ’­çº§åˆ«è§£å†³ï¼Œå…±æœ‰4ç±»çº§åˆ«ï¼Œä»ä½åˆ°é«˜ä¾æ¬¡ä¸ºï¼šè¯»æœªæäº¤ã€è¯»å·²æäº¤ã€å¯é‡å¤è¯»ã€å¯ä¸²è¡ŒåŒ–ï¼Œä»–ä»¬å¯¹æ•°æ®åº“æ€§èƒ½çš„å½±å“å¦‚ä¸‹ï¼š
>
> ![ä¸åŒéš”ç¦»çº§åˆ«å¯¹æ€§èƒ½å½±å“](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/008vxvgGgy1h8ji4ny6d7j30zc0jc0ux.jpg)
>
> å½“é‡åˆ°äº‹åŠ¡å¹¶å‘é—®é¢˜æ—¶ï¼Œå¯ä»¥å°è¯•ä»ä»¥ä¸‹å‡ æ–¹é¢ç€æ‰‹æ’æŸ¥ï¼š
>
> 1. æ— æ•°æ®ä¸€è‡´æ€§è¦æ±‚
> 2. åªæœ‰æŸ¥è¯¢çš„äº‹åŠ¡
> 3. äº‹åŠ¡ä¸­æœ‰ç»Ÿè®¡æ±‡æ€»
> 4. å†…å®¹ç¹æ‚çš„å¤§å¤±è¯¯
>
> 
>
> [ä¸‰åˆ†é’Ÿå›¾è§£äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œçœ‹ä¸€éå°±æ‡‚](https://blog.51cto.com/u_15177525/4161377)
>
> 

> [!warning]
>
> `é«˜å¹¶å‘` `æ•°æ®ä¸€è‡´æ€§` `äº‹åŠ¡ä¼ æ’­` `é”ç²’åº¦è®¾è®¡`
>
> å¹¶å‘åœºæ™¯ä¸‹ï¼Œå‘ç°æ•°æ®åº“å†™å…¥æ•°æ®ä¸ä¸€è‡´æ—¶ï¼Œå¯ä»¥è€ƒè™‘æ˜¯å¦æ˜¯äº‹åŠ¡ä¼ æ’­çº§åˆ«å¼•èµ·çš„ï¼Œæ­¤å¤–å…¶ä»–å¯èƒ½å¼•èµ·æ•°æ®ä¸ä¸€è‡´çš„ï¼š
>
> 1. æœªåŠ é”æˆ–é”è®¾è®¡ä¸åˆç†å¯¼è‡´å¤šçº¿ç¨‹å¹¶å‘ä¿®æ”¹å¯¼è‡´æ•°æ®ä¸ä¸€è‡´



## 11æœˆæ—¥å¿—

> [!info]
>
> `Java` `SpringBoot` 
>
> é€šè¿‡ä»¥ä¸‹ä»£ç å—æ¨¡æ‹Ÿç¨‹åºå¼‚å¸¸åœºæ™¯ï¼š
>
> ```Java
>   // X0% çš„æ¦‚ç‡è¿›å…¥ 1/0
>   if (new Random().nextInt(10) < 9) {
>       log.error(LOG + "å‘½ä¸­å¼‚å¸¸åˆ†æ”¯...");
>       int i = 1 / 0;
>   }
> ```
>
> ```java
>             if (new Random().nextInt(10) < 5) {
>                 throw new InterruptedException("å‘½ä¸­å¼‚å¸¸åˆ†æ”¯ã€‚ã€‚ã€‚InterruptedException");
>             }else if(new Random().nextInt(10) < 5){
>                 throw new RuntimeException("å‘½ä¸­å¼‚å¸¸åˆ†æ”¯ã€‚ã€‚ã€‚InterruptedException");
>             }
> ```
>
> å¼‚å¸¸åœºæ™¯ä¸»è¦ç”¨äºéªŒè¯ä»£ç çš„å¥å£®æ€§ï¼Œå¦‚ï¼šå¼‚å¸¸å›æ»šç­‰ã€‚

> [!info] 
>
> `IntelliJ IDEA`    `SpringBoot`
>
> MyBatisé…ç½®è¾“å‡ºSQL:
>
> ```YML
> mybatis-plus:
>   configuration:
>     log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
> ```
>
> é…åˆ IDEA `MyBatis Log Free` æ’ä»¶æŸ¥çœ‹SQLè¾“å‡º
>
> <img src="https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/image-20241202140815514.png" alt="image-20241202140815514" style="zoom:50%;" />

> [!caution]
>
> `spring-boot-starter-amqp:2.3.4.RELEASE` 
>
>  `RabbitMQ 3.12.14`
>
>   `Erlang 25.3.2.13`
>
> 
>
> rabbitmq æ¶ˆè´¹ç«¯æ¶ˆè´¹å¤±è´¥åï¼Œéœ€è€ƒè™‘é‡è¯•æœºåˆ¶ã€‚
>
> å¼•å…¥é‡è¯•æœºåˆ¶åéœ€è€ƒè™‘æ¶ˆæ¯é‡å¤æ¶ˆè´¹é—®é¢˜ï¼Œç¡®ä¿æ•°æ®å¹‚ç­‰ã€‚
>
> æ­¤å¤–ï¼Œé‡è¯•ç­–ç•¥è¦é€‰å¥½ï¼Œé¿å…çŸ­æ—¶é—´å†…äº§ç”Ÿå¤§é‡é‡è¯•è¯·æ±‚ï¼Œé€ æˆç³»ç»Ÿå‹åŠ›å’Œæ¶ˆæ¯å †ç§¯ï¼Œé‡è¯•åˆ°ä¸€å®šæ¬¡æ•°åä»æœªæˆåŠŸçš„ï¼Œéœ€æŠŠæ¶ˆæ¯æ¨é€åˆ°æ­»ä¿¡é˜Ÿåˆ—åšè¿›ä¸€æ­¥å¤„ç†ã€‚
>
> æ³¨æ„ï¼Œå¯¹äºæ•°æ®ä¸€è‡´æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼Œå¦‚ï¼šä¸é’±è¢‹å­ğŸ’°ç›¸å…³çš„ï¼Œå»ºè®®ä½¿ç”¨**æ‰‹åŠ¨ACKæ¨¡å¼**ï¼Œç¡®ä¿æ¶ˆæ¯å¤„ç†çš„å‡†ç¡®æ€§ã€‚
>
> - å‚è€ƒ
>
>   - [RabbitMQè§£å†³æ¶ˆè´¹è€…è¡¥å¿å¹‚ç­‰é—®é¢˜(é‡å¤æ¶ˆè´¹é—®é¢˜)](https://blog.csdn.net/belongtocode/article/details/104310152)
>
>   - [RabbitMQçš„æ¶ˆæ¯ç¡®è®¤æœºåˆ¶Ack Mode](https://blog.csdn.net/qq_60638478/article/details/141220718) 
>
>   - [SpringBootæ•´åˆRabbitMQï¼ˆå°å…”å­æˆç¥ä¹‹è·¯ï¼‰](https://blog.csdn.net/AkiraNicky/article/details/89640512)
>
>   - [Spring AMQP](https://docs.spring.io/spring-boot/reference/messaging/amqp.html)


> [!warning]
> Docker æ‹‰å–é•œåƒæ…¢æ—¶ï¼Œéœ€é…ç½®==å¯è®¿é—®==çš„ç¬¬ä¸‰æ–¹é•œåƒï¼Œå¦‚ï¼š
>
> ```json
> {
> "registry-mirrors": [
>  "http://hub-mirror.c.163.com",
>  "https://docker.mirrors.ustc.edu.cn",
>  "https://pee6w651.mirror.aliyuncs.com"
> ]
> }
> ```
> é…ç½®åï¼Œéœ€è¦é‡è½½æ–‡ä»¶ã€é‡å¯DockeræœåŠ¡

> [!tip]
> Docker å¸¸ç”¨é•œåƒçš„å¯åŠ¨å‚æ•°å¾—æ‡‚ï¼Œæ¯”å¦‚å¯åŠ¨ MySQL:
> ```shell
> docker run -d --restart=always --name mysql \
> -v /datas/mysql/data:/var/lib/mysql \
> -v /datas/mysql/conf:/etc/mysql \
> -v /datas/mysql/log:/var/log/mysql \
> -p 3306:3306 \
> -e TZ=Asia/Shanghai \
> -e MYSQL_ROOT_PASSWORD=root \
> mysql:5.6 \
> --character-set-server=utf8mb4 \
> --collation-server=utf8mb4_general_ci
> ```
> 
> ```
> -v /datas/mysql/data:/var/lib/mysqlï¼šå°†æ•°æ®æ–‡ä»¶å¤¹æŒ‚è½½åˆ°ä¸»æœº
> -v /datas/mysql/conf:/etc/mysqlï¼šå°†é…ç½®æ–‡ä»¶å¤¹æŒ‚åœ¨åˆ°ä¸»æœºï¼Œå¯ä»¥åœ¨å®¿ä¸»æœºæ”¾ä¸€ä»½è‡ªå®šä¹‰ my.cnfæ–‡ä»¶ï¼Œé‚£ä¹ˆå®¹å™¨å°±ä¼šæŒ‰è‡ªå®šä¹‰é…ç½®å¯åŠ¨
> -v /datas/mysql/log:/var/log/mysqlï¼šå°†æ—¥å¿—æ–‡ä»¶å¤¹æŒ‚è½½åˆ°ä¸»æœº
> -p 3306:3306ï¼šå°†å®¹å™¨çš„3306ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„3306ç«¯å£
> -e MYSQL_ROOT_PASSWORD=rootï¼šåˆå§‹åŒ–rootç”¨æˆ·çš„å¯†ç 
> --character-set-server=utf8mb4ï¼šè®¾ç½®å­—ç¬¦é›†
> --collation-server=utf8mb4_general_ciï¼šæ’åºæ–¹å¼
> ```

> [!tip]
> å¯ä»¥åœ¨ Win/Mac ä¸‹åŒæ—¶é…ç½® Githubã€Giteeï¼Œä¹Ÿå¯ä»¥ä¸€ä¸ªé¡¹ç›®ç®¡ç†åŒæ—¶å…³è”Giteeã€Githubåº“


## 10æœˆæ—¥å¿—

> [!caution]
>
> `ç›‘æ§å‘Šè­¦å¹³å°` `ä¸å¥½ç”¨`  
>
> [CAT](https://github.com/dianping/cat/) æ˜¯åŸºäº Java å¼€å‘çš„å®æ—¶åº”ç”¨ç›‘æ§å¹³å°ï¼Œä¸ºç¾å›¢ç‚¹è¯„æä¾›äº†å…¨é¢çš„å®æ—¶ç›‘æ§å‘Šè­¦æœåŠ¡ã€‚
>
> CAT æˆåŠŸéƒ¨ç½²å¹¶è®¿é—®ï¼Œç¯å¢ƒå¦‚ä¸‹ï¼š
>
> - è™šæ‹Ÿæœº Linux Centos8
>
> ```
> [root@localhost cat]# uname -a
> Linux localhost.localdomain 4.18.0-348.7.1.el8_5.x86_64 #1 SMP Wed Dec 22 13:25:12 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux
> ```
>
> - JAVA8
>
> ```
> [root@localhost cat]# java -version
> java version "1.8.0_431"
> Java(TM) SE Runtime Environment (build 1.8.0_431-b10)
> Java HotSpot(TM) Server VM (build 25.431-b10, mixed mode)
> ```
>
> - Tomcat7
>
> ```
> [root@localhost tomcat]# ls
> apache-tomcat-7.0.99.tar.gz   tomcat7
> ```
>
> - Maven3
>
> ```
> [root@localhost tomcat]# mvn -v
> Apache Maven 3.6.3 (cecedd343002696d0abb50b32b541b8a6ba2883f)
> Maven home: /opt/maven/apache-maven-3.6.3
> Java version: 1.8.0_431, vendor: Oracle Corporation, runtime: /usr/java/jdk1.8.0_431/jre
> Default locale: zh_CN, platform encoding: UTF-8
> OS name: "linux", version: "4.18.0-348.7.1.el8_5.x86_64", arch: "i386", family: "unix"
> ```
>
> -  ç¯å¢ƒå‡†å¤‡å®Œæ¯•åï¼Œå°† `cat.war`  æ”¾ç½®åœ¨è¿™ä¸ªè·¯å¾„ä¸‹ï¼š [waråŒ…ä¸‹è½½åœ°å€](https://github.com/dianping/cat/releases/tag/v3.0.0)
>
> ```shell
> [root@localhost webapps]# pwd
> /opt/tomcat/tomcat7/webapps
> [root@localhost webapps]# ls
> cat  cat.war  docs  examples  host-manager  manager  ROOT
> [root@localhost webapps]#
> ```
>
> - å¯åŠ¨ CAT æœåŠ¡ï¼š
>
> ```shell
> -- è¿›å…¥ Tomcat7 bin ç›®å½•
> [root@localhost bin]# pwd
> /opt/tomcat/tomcat7/bin
> -- æ‰§è¡Œ sh catalina.sh
> [root@localhost bin]# sh catalina.sh
> ```
>
> ![ç›‘æ§ç•Œé¢](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/image-20241204153043961.png)
>
> è®¿é—®é…ç½®ç®¡ç†ç•Œé¢ï¼š
>
> ![é…ç½®ç®¡ç†ç™»å½•é¡µ](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/image-20241204153127435.png)
>
> ![å®¢æˆ·ç«¯è·¯ç”±é…ç½®ç•Œé¢](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/image-20241204153146238.png)
>
> ![æœåŠ¡ç«¯é…ç½®ç•Œé¢](https://cdn.jsdelivr.net/gh/zhengzhenning/imageBeds@main/images/image-20241204153218576.png)
